tosca_definitions_version: tosca_simple_yaml_1_2

imports:
  - https://raw.githubusercontent.com/indigo-dc/tosca-types/refactor_dodas/custom_types.yaml

# Index
  # - KUBERNETES APPLICATION TOOLS
  # - Experimental: K3s

node_types:

  # KUBERNETES APPLICATION TOOLS
  ############################################################
  # - tosca.nodes.indigo.HelmInstall
  # - tosca.nodes.indigo.KubeCreate


  tosca.nodes.indigo.HelmInstall:
    derived_from: tosca.nodes.SoftwareComponent
    properties:
      name:
        type: string
        description: name of the helm deployment
        required: yes
      chart:
        type: string
        description: chart name
        required: yes
      repos:
        type: list
        entry_schema:
          type: map
          entry_schema:
            type: string
      values_file:
        type: string
        description: values.yaml file content
        required: no
        default: ""
      values_url:
        type: string
        description: values.yaml file url
        required: no
        default: ""
      kubeconfig_path:
        type: string
        required: no
        default: /etc/kubernetes/admin.conf
      inline_options:
        type: string
        required: no
        default: ""
      # externalParams:
      #   type: string
      #   required: no
      #   default: "" 
      role_name:
        type: string
        required: no
        default: dciangot.ansible_role_helmtest
    artifacts:
      helm_config_role:
        file: dciangot.ansible_role_helmtest
        type: tosca.artifacts.AnsibleGalaxy.role
    interfaces:
      Standard:
        start:
          implementation: https://raw.githubusercontent.com/indigo-dc/tosca-types/refactor_dodas/dodas_types/dodas_artifacts/ansible.yaml
          inputs:
            role_name:  { get_property: [ SELF, role_name ] }
            name: { get_property: [ SELF, name ] }
            chart: { get_property: [ SELF, chart ] }
            values_file: { get_property: [ SELF, values_file ] }
            values_url: { get_property: [ SELF, values_url ] }
            inline_options: { get_property: [ SELF, inline_options ] }
            kubeconfig_path: { get_property: [ SELF, kubeconfig_path ] }
            repos: { get_property: [ SELF, repos ] }
            #externalParams: { get_property: [ SELF, externalParams ] }


  tosca.nodes.indigo.KubeCreate:
    derived_from: tosca.nodes.SoftwareComponent
    properties:
      name:
        type: string
        description: name of the helm deployment
        required: no
        default: ""
      namespace:
        type: string
        required: no
        default: default
      url:
        type: string
        required: no
        default: ""
      manifest_file:
        type: string
        required: no
        default: ""
      inline_options:
        type: string
        required: no
        default: ""
      externalParams:
        type: list
        required: no
        default: []
      role_name:
        type: string
        required: no
        default: cloud-pg.ansible_role_kubecreate
    artifacts:
      kubecreate_config_role:
        file: cloud-pg.ansible_role_kubecreate
        type: tosca.artifacts.AnsibleGalaxy.role
    interfaces:
      Standard:
        start:
          implementation: https://raw.githubusercontent.com/indigo-dc/tosca-types/refactor_dodas/dodas_types/dodas_artifacts/ansible.yaml
          inputs:
            role_name: { get_property: [ SELF, role_name ] }
            name: { get_property: [ SELF, name ] }
            namespace:   { get_property: [ SELF, namespace ] }
            url: { get_property: [ SELF, url ] }
            inline_options: { get_property: [ SELF, inline_options ] }
            manifest_file: { get_property: [ SELF, manifest_file ] }
            externalParams: { get_property: [ SELF, externalParams ] }

  # Experimental: K3s
  ############################################################
  # - tosca.nodes.indigo.k3s

  tosca.nodes.indigo.k3s:
    derived_from: tosca.nodes.SoftwareComponent
    properties:
      master_ip:
        type: string
        required: yes
      mode:
        type: string
        required: yes
      node_label:
        type: string
        required: no
        default: unlabelled=true
      role_name:
        type: string
        required: no
        default: cloud-pg.ansible_role_k3s
    artifacts:
      k3s_config_role:
        file: cloud-pg.ansible_role_k3s
        type: tosca.artifacts.AnsibleGalaxy.role
    interfaces:
      Standard:
        start:
          implementation: https://raw.githubusercontent.com/indigo-dc/tosca-types/refactor_dodas/dodas_types/dodas_artifacts/ansible.yaml
          inputs:
            master_ip: { get_property: [ SELF, master_ip ] }
            mode: { get_property: [ SELF, mode ] }
            node_label: { get_property: [ SELF, node_label ] }
